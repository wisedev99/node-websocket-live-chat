<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>WebSocket Client</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
            }

            #messages {
                border: 1px solid #ccc;
                padding: 10px;
                height: 200px;
                overflow-y: scroll;
            }
        </style>
    </head>

    <body>
        <h1>WebSocket Client</h1>

        <input type="text" id="roleInput" placeholder="Enter role (client/operator)" />
        <button id="registerButton">Register</button>

        <div id="messages"></div>

        <input type="text" id="messageInput" placeholder="Type a message..." />
        <button id="sendButton">Send</button>

        <script>
            let socket;
            const messagesDiv = document.getElementById('messages');

            document.getElementById('registerButton').onclick = () => {
                const role = document.getElementById('roleInput').value;
                socket = new WebSocket('ws://localhost:413'); // Connect to the WebSocket server

                socket.onopen = () => {
                    console.log('WebSocket connection established');
                    socket.send(JSON.stringify({ type: 'register', role: role.toLowerCase() }));
                    document.getElementById('roleInput').disabled = true;
                    document.getElementById('registerButton').disabled = true;
                };

                socket.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.message) {
                        messagesDiv.innerHTML += '<p>' + data.message + '</p>';
                    }
                    if (data.clientMessage) {
                        messagesDiv.innerHTML += '<p><strong>Client:</strong> ' + data.clientMessage + '</p>';
                    }
                    if (data.operatorMessage) {
                        messagesDiv.innerHTML += '<p><strong>Operator:</strong> ' + data.operatorMessage + '</p>';
                    }
                };

                socket.onerror = (error) => {
                    console.error('WebSocket error: ', error);
                };

                socket.onclose = () => {
                    console.log('WebSocket connection closed');
                };
            };

            // Send a message when the button is clicked
            document.getElementById('sendButton').onclick = () => {
                const input = document.getElementById('messageInput');
                const message = input.value;
                if (message) {
                    if (document.getElementById('roleInput').value.toLowerCase() === 'client') {
                        socket.send(JSON.stringify({ type: 'clientMessage', text: message }));
                    } else if (document.getElementById('roleInput').value.toLowerCase() === 'operator') {
                        socket.send(JSON.stringify({ type: 'operatorMessage', text: message }));
                    }
                    input.value = ''; // Clear the input field
                }
            };
        </script>
    </body>

</html>
